var e,r=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(e,t,a)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,l=(e,r,t)=>new Promise(((a,o)=>{var n=e=>{try{s(t.next(e))}catch(r){o(r)}},l=e=>{try{s(t.throw(e))}catch(r){o(r)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,l);s((t=t.apply(e,r)).next())}));import{f as s,g as i}from "./useForm.bb6fa296.js";import{i as d,a as c}from "./system.78153014.js";import{B as u,a as m}from "./index.d55bbd60.js";import{_ as p}from "./Tree.vue_vue&type=style&index=0&lang.f9b58fa2.js";import{aJ as f,aK as h}from "./index.446d454d.js";import{B as v,r as b,j as y,u as g,_ as w,$ as I,D as O,a0 as x,a4 as R,w as j,a3 as D}from "./vendor.4c4242b5.js";(e||(e={})).ROLE="/system/role";const k= r=>f.delete({url:e.ROLE+"/"+r}),T=[{title:"角色名称",dataIndex:"roleName",width:200},{title:"创建时间",dataIndex:"createTime",width:180},{title:"备注",dataIndex:"remark"}],_=[{field:"roleNme",label:"角色名称",component:"Input",colProps:{span:8}}],B=[{field:"roleId",label:"角色编号",component:"Input",required:!0,ifShow:!1},{field:"roleName",label:"角色名称",component:"Input",helpMessage:["角色名不能重复"],dynamicRules:({values:e})=>[{required:!0,validator:(r, t)=>new Promise(((r, a)=>{const{roleId:o}=e;return o?t?void d(o,t).then((e=>e?a("角色名已被使用"):r())).catch((e=>a(e.msg||"验证失败"))):a("角色名不能为空"):r()}))}]},{label:"备注",field:"remark",component:"InputTextArea"},{label:"",field:"menuIds",slot:"menu",component:"Input"}];var F=v({name:"RoleDrawer",components:{BasicDrawer:u,BasicForm:s,BasicTree:p},emits:["success","register"],setup(r, {emit:s}){const d=b(!1),u=b(""),p=b([]),v=b(),I=b();const[O,{resetFields:x,setFieldsValue:R,validate:j,clearValidate:D}]=i({labelWidth:90,schemas:B,showActionButtonGroup:!1}),[k,{setDrawerProps:T,closeDrawer:_}]=m((e=>l(this,null,(function*(){var r;x(),T({confirmLoading:!1}),0===g(p).length&&(p.value=yield c(),w((()=>{(function(){const e=g(v);if(!e)throw new Error("tree is null!");return e})().expandAll(!0)}))),d.value=!!(null==e?void 0:e.isUpdate),g(d)&&(u.value=e.record.roleId,e.record.menuIds=(r=e.record.menuIds,I.value=r,r=P(p.value,r,[])),R(((e, r)=>{for(var l in r||(r={}))a.call(r,l)&&n(e,l,r[l]);if(t)for(var l of t(r))o.call(r,l)&&n(e,l,r[l]);return e})({},e.record))),D()})))),F=y((()=>g(d)?"编辑角色":"新增角色"));function P(e, r, t){for(let a=0; a<e.length; a++){const o=e[a];o.children&&0!==o.children.length?P(o.children,r,t):-1!==r.indexOf(o.id)&&t.push(o.id)}return t}return{treeRef:v,registerDrawer:k,registerForm:O,getTitle:F,handleSubmit:function(){return l(this,null,(function*(){try{const t=yield j();T({confirmLoading:!0}),t.menuIds=I.value,g(d)?(t.roleId=u.value,yield(r=t,f.put({url:e.ROLE,headers:{"Content-Type":h.JSON},data:r}))):yield(r=>f.post({url:e.ROLE,headers:{"Content-Type":h.JSON},data:r}))(t),_(),s("success")}finally{T({confirmLoading:!1})}var r}))},treeData:p,checkMenu:function(e, r){const{halfCheckedKeys:t}=r;I.value=[...e,...t]}}}});F.render=function(e, r, t, a, o, n){const l=I("BasicTree"),s=I("BasicForm"),i=I("BasicDrawer");return O(),x(i,D(e.$attrs,{onRegister:e.registerDrawer,showFooter:"",title:e.getTitle,width:"500px",onOk:e.handleSubmit}),{default:R((()=>[j(s,{onRegister:e.registerForm},{menu:R((({model:r,field:t})=>[j(l,{value:r[t],"onUpdate:value": e=>r[t]=e,treeData:e.treeData,replaceFields:{title:"label",key:"id"},checkable:"",onCheck:e.checkMenu,ref:"treeRef",toolbar:!1,title:"菜单分配"},null,8,["value","onUpdate:value","treeData","onCheck"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title","onOk"])};var P=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:F});export{P as R,F as _,T as c,k as d,_ as s};
