import{B as e,aY as a,an as s,r as l,O as t,j as n,u as o,D as r,F as i,G as d,H as u,w as c,a4 as p,aZ as m,a_ as f,ac as g,K as y,aR as _,a$ as v,J as x,b0 as h,b1 as b,b2 as k,b3 as w,b4 as S,L as j,b5 as C,a9 as U,b6 as E,b7 as T,t as I}from "./vendor.4c4242b5.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import{b as L}from "./uuid.5e4d726a.js";import{u as R,a as z,L as F,_ as P,b as O}from "./LoginFormTitle.vue_vue&type=script&setup=true&lang.ae413af1.js";import{a as $,f as B,u as D,e as M,h as G}from "./index.446d454d.js";var K=e({setup(e){const K=E,q=T,N=a.Item,A=s.Password,{t:H}=M(),{notification:J,createErrorModal:Q}=G(),{prefixCls:W}=$("login"),Y=B(),{setLoginState:Z,getLoginState:V}=R(),{getFormRules:X}=z(),ee=l(),ae=l(!1),se=l(!1);let le=L();const te=D(),ne=t({username:"",password:"",code:"",key:le,codeUrl:de(le),preview:!1}),{validForm:oe}=O(ee),re=n((()=>o(V)===F.LOGIN));function ie(){le=L(),ne.key=le,ne.codeUrl=de(le)}function de(e){return te.apiUrl+"/auth/captcha?key="+e}function ue(){return e=this,a=null,s=function*(){if(yield oe())try{ae.value=!0;const e=yield Y.login(I({grant_type:"password",username:ne.username,password:ne.password,key:ne.key,code:ne.code,mode:"none"}));e&&J.success({message:H("sys.login.loginSuccessTitle"),description:`${H("sys.login.loginSuccessDesc")}: ${e.principal.username}`,duration:3})}catch(e){10001==e.status&&(ne.code="",ie()),Q({title:H("sys.api.errorTip"),content:e.data.msg||H("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${W}`)||document.body})}finally{ae.value=!1}},new Promise(((l, t)=>{var n= e=>{try{r(s.next(e))}catch(a){t(a)}},o= e=>{try{r(s.throw(e))}catch(a){t(a)}},r= e=>e.done?l(e.value):Promise.resolve(e.value).then(n,o);r((s=s.apply(e,a)).next())}));var e,a,s}return(e, l)=>(r(),i(U,null,[d(c(P,{class:"enter-x"},null,512),[[u,o(re)]]),d(c(o(a),{class:"p-4 enter-x",model:o(ne),rules:o(X),ref:ee,onKeypress:C(ue,["enter"])},{default:p((()=>[c(o(N),{name:"username",class:"enter-x"},{default:p((()=>[c(o(s),{size:"large",value:o(ne).username,"onUpdate:value":l[0]||(l[0]= e=>o(ne).username=e),placeholder:o(H)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])])),_:1}),c(o(N),{name:"password",class:"enter-x"},{default:p((()=>[c(o(A),{size:"large",visibilityToggle:"",value:o(ne).password,"onUpdate:value":l[1]||(l[1]= e=>o(ne).password=e),placeholder:o(H)("sys.login.password")},null,8,["value","placeholder"])])),_:1}),c(o(q),{class:"enter-x"},{default:p((()=>[c(o(K),{span:12},{default:p((()=>[c(o(N),{name:"code"},{default:p((()=>[c(o(s),{size:"large",value:o(ne).code,"onUpdate:value":l[2]||(l[2]= e=>o(ne).code=e),placeholder:o(H)("sys.login.smsPlaceholder"),class:"fix-auto-fill"},null,8,["value","placeholder"])])),_:1})])),_:1}),c(o(K),{span:12},{default:p((()=>[c(o(N),{name:"codeUrl",style:{"text-align":"right"}},{default:p((()=>[c(o(m),{height:"100%",preview:o(ne).preview,onClick:ie,src:o(ne).codeUrl},null,8,["preview","src"])])),_:1})])),_:1})])),_:1}),c(o(q),{class:"enter-x"},{default:p((()=>[c(o(K),{span:12},{default:p((()=>[c(o(N),null,{default:p((()=>[c(o(f),{checked:se.value,"onUpdate:checked":l[3]||(l[3]= e=>se.value=e),size:"small"},{default:p((()=>[g(y(o(H)("sys.login.rememberMe")),1)])),_:1},8,["checked"])])),_:1})])),_:1}),c(o(K),{span:12},{default:p((()=>[c(o(N),{style:{"text-align":"right"}},{default:p((()=>[c(o(_),{type:"link",size:"small",onClick:l[4]||(l[4]= e=>o(Z)(o(F).RESET_PASSWORD))},{default:p((()=>[g(y(o(H)("sys.login.forgetPassword")),1)])),_:1})])),_:1})])),_:1})])),_:1}),c(o(N),{class:"enter-x"},{default:p((()=>[c(o(_),{type:"primary",size:"large",block:"",onClick:ue,loading:ae.value},{default:p((()=>[g(y(o(H)("sys.login.loginButton")),1)])),_:1},8,["loading"])])),_:1}),c(o(q),{class:"enter-x"},{default:p((()=>[c(o(K),{md:8,xs:24},{default:p((()=>[c(o(_),{block:"",onClick:l[5]||(l[5]= e=>o(Z)(o(F).MOBILE))},{default:p((()=>[g(y(o(H)("sys.login.mobileSignInFormTitle")),1)])),_:1})])),_:1}),c(o(K),{md:8,xs:24,class:"!my-2 !md:my-0 xs:mx-0 md:mx-2"},{default:p((()=>[c(o(_),{block:"",onClick:l[6]||(l[6]= e=>o(Z)(o(F).QR_CODE))},{default:p((()=>[g(y(o(H)("sys.login.qrSignInFormTitle")),1)])),_:1})])),_:1}),c(o(K),{md:7,xs:24},{default:p((()=>[c(o(_),{block:"",onClick:l[7]||(l[7]= e=>o(Z)(o(F).REGISTER))},{default:p((()=>[g(y(o(H)("sys.login.registerButton")),1)])),_:1})])),_:1})])),_:1}),c(o(v),{class:"enter-x"},{default:p((()=>[g(y(o(H)("sys.login.otherSignIn")),1)])),_:1}),x("div",{class:j(["flex justify-evenly enter-x",`${o(W)}-sign-in-way`])},[c(o(h)),c(o(b)),c(o(k)),c(o(w)),c(o(S))],2)])),_:1},8,["model","rules","onKeypress"]),[[u,o(re)]])],64))}});export{K as _};
