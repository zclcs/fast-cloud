server:
  port: ${PORT_GATEWAY:8301}

spring:

  datasource:
    dynamic:
      p6spy: ${LOG_SQL_ENABLED:true}
      hikari:
        connection-timeout: 30000
        max-lifetime: 1800000
        max-pool-size: 15
        min-idle: 5
        connection-test-query: select 1
      primary: primary
      datasource:
        primary:
          driver-class-name: ${DATASOURCE_DRIVER:com.mysql.cj.jdbc.Driver}
          url: jdbc:${DATASOURCE_DB_TYPE:mysql}://${DATASOURCE_HOST:127.0.0.1}:${DATASOURCE_PORT:3306}/${DB_NAME_SYSTEM:cloud_system}?${DATASOURCE_PARAM:useUnicode=true&characterEncoding=UTF-8&useSSL=false&zeroDateTimeBehavior=convertToNull&serverTimezone=Asia/Shanghai}
          username: ${DATASOURCE_USERNAME:root}
          password: ${DATASOURCE_PASSWORD:root}

  cloud:
    gateway:
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "*"
            allowCredentials: true
      routes:
        - id: ${SERVICE_NAME_AUTH:auth}
          uri: lb://${SERVICE_NAME_AUTH:auth}
          predicates:
            - Path=${SERVICE_PATH_AUTH:/auth}/**
          filters:
            - name: Hystrix
              args:
                name: authfallback
                fallbackUri: forward:/fallback/${SERVICE_NAME_AUTH:auth}
        - id: ${SERVICE_NAME_SERVER_SYSTEM:server-system}
          uri: lb://${SERVICE_NAME_SERVER_SYSTEM:server-system}
          predicates:
            - Path=${SERVICE_PATH_SERVER_SYSTEM:/system}/**
          filters:
            - name: Hystrix
              args:
                name: systemfallback
                fallbackUri: forward:/fallback/${SERVICE_NAME_SERVER_SYSTEM:server-system}
        - id: ${SERVICE_NAME_SERVER_GENERATOR:server-generator}
          uri: lb://${SERVICE_NAME_SERVER_GENERATOR:server-generator}
          predicates:
            - Path=${SERVICE_PATH_SERVER_GENERATOR:/generator}/**
          filters:
            - name: Hystrix
              args:
                name: generatorfallback
                fallbackUri: forward:/fallback/${SERVICE_NAME_SERVER_GENERATOR:server-generator}
        - id: ${SERVICE_NAME_SERVER_TEST:server-test}
          uri: lb://${SERVICE_NAME_SERVER_TEST:server-test}
          predicates:
            - Path=${SERVICE_PATH_SERVER_TEST:/test}/**
          filters:
            - name: Hystrix
              args:
                name: testfallback
                fallbackUri: forward:/fallback/${SERVICE_NAME_SERVER_TEST:server-test}
        - id: ${SERVICE_NAME_SERVER_MINIO:server-minio}
          uri: lb://${SERVICE_NAME_SERVER_MINIO:server-minio}
          predicates:
            - Path=${SERVICE_PATH_SERVER_MINIO:/minio}/**
          filters:
            - name: Hystrix
              args:
                name: miniofallback
                fallbackUri: forward:/fallback/${SERVICE_NAME_SERVER_MINIO:server-minio}
        - id: ${SERVICE_NAME_SERVER_DICT:server-dict}
          uri: lb://${SERVICE_NAME_SERVER_DICT:server-dict}
          predicates:
            - Path=${SERVICE_PATH_SERVER_DICT:/dict}/**
          filters:
            - name: Hystrix
              args:
                name: miniofallback
                fallbackUri: forward:/fallback/${SERVICE_NAME_SERVER_DICT:server-dict}
      loadbalancer:
        use404: true
      default-filters:
        - StripPrefix=1

mybatis-plus:
  type-aliases-package: com.zclcs.common.core.entity.system
  mapper-locations: classpath:com/zclcs/gateway/mapper/*.xml
  configuration:
    jdbc-type-for-null: null
  global-config:
    banner: false

my:
  lettuce:
    redis:
      cache-prefix: ${my.redis-cache.gateway-prefix}
  log:
    enable-log-for-controller: ${LOG_CONTROLLER_PARAMS_GATEWAY:false}

hystrix:
  command:
    default:
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 10000

    socialfallback:
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 60000

ribbon:
  eager-load:
    enabled: true

